# โ ุญู ููุงุฆู ููุดููุฉ Insufficient Stock Quantity

## ๐ ุงููุดููุฉ
- **ุงูุฎุทุฃ**: 409 Conflict - "Insufficient stock quantity"
- **ุงูุณุจุจ**: ุนูุฏ ูุญุงููุฉ ุตุฑู ูุทุนุฉ ูู ูุฎุฒู ุจุฏูู ูุฎุฒููุ ุงููุธุงู ูุฑูุถ ุงูุนูููุฉ
- **ุงูุชุฃุซูุฑ**: ูุง ูููู ุตุฑู ูุทุน ููุฅุตูุงุญุงุช ุงูุนุงุฌูุฉ ุฅุฐุง ูู ููู ููุงู ูุฎุฒูู ูุงูู

---

## โ ุงูุญู ุงููุทุจู

### **1. ุงูุชุญูู ูู ุงููุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู**
- ูุจู ุฑูุถ ุงูุนูููุฉุ ุงููุธุงู ูุชุญูู ูู ูุฌูุฏ ูุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู
- ุฅุฐุง ููุฌุฏ ูุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑูุ ููุนุงุฏ ุฑุณุงูุฉ ุชูุถุญ ุฐูู ูุชูุชุฑุญ ููู ุงููุฎุฒูู

### **2. ุงูุณูุงุญ ุจุงูุตุฑู ุญุชู ูุน ุนุฏู ูุฌูุฏ ูุฎุฒูู**
- **ููุฅุตูุงุญุงุช ุงูุนุงุฌูุฉ**: ุงููุธุงู ูุณูุญ ุจุงูุตุฑู ุญุชู ุฅุฐุง ูู ููู ููุงู ูุฎุฒูู ูุงูู
- **ุงููุฎุฒูู ุงูุณุงูุจ**: ุงููุธุงู ูุณูุญ ุจุงููุฎุฒูู ุงูุณุงูุจ (ุณูุชู ุชุตุญูุญู ูุงุญูุงู ุนุจุฑ ุชุนุฏููุงุช ุงููุฎุฒูู)
- **ุชุญุฐูุฑ ูุงุถุญ**: ูุชู ุฅุฑุณุงู ุชุญุฐูุฑ ูู ุงูู response ุนูุฏ ุตุฑู ูุทุน ุจุฏูู ูุฎุฒูู

### **3. ุชุญุณูู ุงูุฑุณุงุฆู ูุงูุชุญุฐูุฑุงุช**
- ุฑุณุงุฆู ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ ุชุดุฑุญ ุงููุถุน
- ูุนูููุงุช ุนู ุงููุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู ุฅู ููุฌุฏ
- ุชุญุฐูุฑ ุนูุฏ ุตุฑู ูุทุน ุจุฏูู ูุฎุฒูู

---

## ๐ง ุงูุชุบููุฑุงุช ูู ุงูููุฏ

### **`backend/routes/inventoryIssue.js`**

#### **ูุจู:**
```javascript
// ุฑูุถ ุงูุนูููุฉ ุฅุฐุง ูู ููู ููุงู ูุฎุฒูู ูุงูู
if (currentQty < quantity) {
  await conn.rollback();
  return res.status(409).json({ 
    success: false,
    message: 'Insufficient stock quantity'
  });
}
```

#### **ุจุนุฏ:**
```javascript
// ุงูุชุญูู ูู ูุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู ุฃููุงู
if (currentQty < quantity) {
  // Check other warehouses
  if (otherWarehousesStock.length > 0) {
    // Suggest transfer from other warehouse
    return res.status(409).json({ 
      message: 'ููุฌุฏ ูุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู...',
      otherWarehousesStock: [...]
    });
  }
  
  // Allow issuing with zero stock for urgent repairs
  // Will result in negative stock - can be corrected later
  console.warn(`โ๏ธ Issuing part with zero stock`);
  // Continue with the process
}
```

---

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### **ุณููุงุฑูู 1: ููุฌุฏ ูุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู**
```
โ Response: 409 Conflict
โ Message: "ููุฌุฏ ูุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู. ููููู ููู ุงููุฎุฒูู..."
โ Data: otherWarehousesStock: [{warehouseId: X, quantity: Y, ...}]
```

### **ุณููุงุฑูู 2: ูุง ููุฌุฏ ูุฎุฒูู ููุงุฆูุงู**
```
โ Response: 200 Success
โ Message: "ุชู ุตุฑู ุงููุทุนุฉ ุจูุฌุงุญ. โ๏ธ ุชุญุฐูุฑ: ุงููุฎุฒูู ุฃุตุจุญ ุณุงูุจุงู..."
โ Warning: { message: "...", newQuantity: -1, actionRequired: "add_stock" }
```

### **ุณููุงุฑูู 3: ููุฌุฏ ูุฎุฒูู ูุงูู**
```
โ Response: 200 Success
โ Message: "ุชู ุตุฑู ุงููุทุนุฉ ุจูุฌุงุญ"
โ No warnings
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุงููุฎุฒูู ุงูุณุงูุจ**: 
   - ุงููุธุงู ูุณูุญ ุจุงููุฎุฒูู ุงูุณุงูุจ ููุฅุตูุงุญุงุช ุงูุนุงุฌูุฉ
   - ูุฌุจ ุชุตุญูุญ ุงููุฎุฒูู ูุงุญูุงู ุนุจุฑ ุชุนุฏููุงุช ุงููุฎุฒูู ุฃู ุฅุถุงูุฉ ูุฎุฒูู ุฌุฏูุฏ

2. **ุงูุชุญูู ูู ุงููุฎุฒูู**: 
   - ูุฌุจ ุนูู ุงููุณุชุฎุฏููู ุงูุชุญูู ูู ุงููุฎุฒูู ุงููุชุงุญ ูุจู ุงูุตุฑู
   - ุฑุณุงุฆู ุงูุชุญุฐูุฑ ูุงุถุญุฉ ูููุตูุฉ

3. **ุชุตุญูุญ ุงููุฎุฒูู**: 
   - ุนูุฏ ุฅุถุงูุฉ ูุฎุฒูู ุฌุฏูุฏุ ุณูุชู ุชุตุญูุญ ุงููุฎุฒูู ุงูุณุงูุจ ุชููุงุฆูุงู
   - ูููู ุฅุฌุฑุงุก ุชุนุฏููุงุช ูุฎุฒูู ูุฏููุฉ ูุชุตุญูุญ ุงูุฃุฑูุงู

---

## ๐ฏ ุงููุฒุงูุง

- โ **ูุฑููุฉ ุฃูุจุฑ**: ุงูุณูุงุญ ุจุงูุฅุตูุงุญุงุช ุงูุนุงุฌูุฉ ุญุชู ุจุฏูู ูุฎุฒูู
- โ **ุฑุณุงุฆู ูุงุถุญุฉ**: ุชูุถูุญ ุงููุถุน ูููุณุชุฎุฏู ุจุดูู ูุงูู
- โ **ุงูุชุฑุงุญุงุช ูููุฏุฉ**: ุฅุธูุงุฑ ุงููุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู
- โ **ุชุชุจุน ุฃูุถู**: ุชุญุฐูุฑุงุช ูุงุถุญุฉ ุนูุฏ ุงุณุชุฎุฏุงู ูุฎุฒูู ุณุงูุจ

---

**ุชุงุฑูุฎ ุงูุชุทุจูู**: 22 ููููุจุฑ 2025

