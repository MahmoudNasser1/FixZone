# ๐ ุชุญููู ูุญุฏุฉ Stock Transfers
## Stock Transfers Module Analysis

**ุงูุชุงุฑูุฎ:** 2025-11-20  
**ุงููููุฏุณ:** Auto (Cursor AI) - QA Engineer  
**ุงูุญุงูุฉ:** ๐ **ุฌุงุฑู ุงูุนูู**

---

## ๐ ูุธุฑุฉ ุนุงูุฉ
**ุงููุตู:** ููู ุงููุฎุฒูู - ุฅุฏุงุฑุฉ ููู ุงููุฎุฒูู ุจูู ุงููุฎุงุฒู.

**ุงูููููุงุช:**
- **Backend:** 9 routes (GET /, GET /stats, GET /:id, POST /, PUT /:id/approve, PUT /:id/ship, PUT /:id/receive, PUT /:id/complete, DELETE /:id)
- **Frontend:** 1 page (StockTransferPage)
- **Database:** 2 tables (StockTransfer, StockTransferItem)

---

## โ ุงูุฌูุงูุจ ุงูุฅูุฌุงุจูุฉ (ุงูููุฌูุฏุฉ ุญุงููุงู)

### Backend:
- โ CRUD ูุงูู ูุน `authMiddleware` ุนูู ุฌููุน ุงูู routes
- โ ุฏุนู workflow ูุงูู (approve, ship, receive, complete)
- โ ุชุญุฏูุซ `StockLevel` ุชููุงุฆูุงู ุนูุฏ ุงูุงุณุชูุงู
- โ ุฅูุดุงุก `StockMovement` ุชููุงุฆูุงู (IN/OUT) ุนูุฏ ุงูุงุณุชูุงู
- โ ุฏุนู transactions ููุถูุงูุงุช (`BEGIN TRANSACTION`, `COMMIT`, `ROLLBACK`)
- โ Validation ุจุงุณุชุฎุฏุงู Joi
- โ Custom validation (ููุน ููู ูู ููุณ ุงููุฎุฒู)
- โ Filtering (fromWarehouseId, toWarehouseId, status, date range)
- โ Pagination
- โ Statistics endpoint (`/stats`)
- โ Status validation (ุงูุชุญูู ูู ุงูุญุงูุฉ ูุจู ุงูุงูุชูุงู)
- โ ุงุณุชุฎุฏุงู `db.execute` ูู ุฌููุน ุงูู queries (ูุชุญุณูู ุงูุฃูุงู)

### Frontend:
- โ ุตูุญุฉ StockTransferPage ููุฌูุฏุฉ
- โ ุฏุนู ุฅูุดุงุก ููู ุฌุฏูุฏ
- โ ุนุฑุถ ูุงุฆูุฉ ุงููููุงุช
- โ ุฏุนู Workflow actions (approve, ship, receive)
- โ Integration ูุน Warehouse ู InventoryItem services

---

## โ ุงูููุงูุต ูุงููุดุงูู (ุชู ุฅุตูุงุญูุง)

### Backend:
1. โ **ูุดููุฉ ูู `approveStockTransfer` - Status validation:**
   - **ุงููุดููุฉ:** ุงูููุฏ ูุชุญูู ูู `status !== 'draft'` ููู ุงูุญุงูุฉ ุงูุงูุชุฑุงุถูุฉ ุนูุฏ ุงูุฅูุดุงุก ูู `'pending'`
   - **ุงูุญุงูุฉ:** โ **ุชู ุงูุฅุตูุงุญ**
   - **ุงูุญู ุงููุทุจู:** ุชุบููุฑ `'draft'` ุฅูู `'pending'` ูู validation

2. โ **ูุดููุฉ ูู Validation Schemas:**
   - **ุงููุดููุฉ:** `approveSchema` ู `shipSchema` ูุชุทูุจุงู `approvedBy` ู `shippedBy` ุจุดูู ุฅูุฒุงููุ ููู ุงูููุฏ ูุณุชุฎุฏู `req.user.id` ูู fallback
   - **ุงูุญุงูุฉ:** โ **ุชู ุงูุฅุตูุงุญ**
   - **ุงูุญู ุงููุทุจู:** ุฌุนู ูุฐู ุงูุญููู ุงุฎุชูุงุฑูุฉ (optional) ูู validation ูุฅุถุงูุฉ `req.user.id` ูู fallback

3. โ **ุนุฏู ุงูุชุญูู ูู ุงููููุฉ ุงููุชุงุญุฉ ูุจู ุงูููู:**
   - **ุงููุดููุฉ:** ุนูุฏ ุงุณุชูุงู ุงููููุ ูุชู ุงูุชุญูู ูู ุงููููุฉุ ููู ูุง ูุชู ุงูุชุญูู ุนูุฏ ุงูุฅูุดุงุก ุฃู ุงูููุงููุฉ
   - **ุงูุญุงูุฉ:** โ **ุชู ุงูุฅุตูุงุญ**
   - **ุงูุญู ุงููุทุจู:** ุฅุถุงูุฉ validation ูููููุฉ ุงููุชุงุญุฉ ุนูุฏ ุงูุฅูุดุงุก ูู `createStockTransfer`

4. โ **ุนุฏู ุงุณุชุฎุฏุงู transactions ูู `createStockTransfer`:**
   - **ุงููุดููุฉ:** `createStockTransfer` ูููู ุจุนูููุงุช ูุชุนุฏุฏุฉ (ุฅูุดุงุก ุงูููู + ุฅุถุงูุฉ ุงูุนูุงุตุฑ) ุจุฏูู transaction
   - **ุงูุญุงูุฉ:** โ **ุชู ุงูุฅุตูุงุญ**
   - **ุงูุญู ุงููุทุจู:** ุงุณุชุฎุฏุงู transactions ูู `createStockTransfer` ุจุงุณุชุฎุฏุงู `db.getConnection()`

5. โ **ุนุฏู ุงุณุชุฎุฏุงู transactions ูู `deleteStockTransfer`:**
   - **ุงููุดููุฉ:** `deleteStockTransfer` ูููู ุจุญุฐู ุงูููู ูุงูุนูุงุตุฑ ุงููุฑุชุจุทุฉ ุจุฏูู transaction
   - **ุงูุญุงูุฉ:** โ **ุชู ุงูุฅุตูุงุญ**
   - **ุงูุญู ุงููุทุจู:** ุงุณุชุฎุฏุงู transactions ูู `deleteStockTransfer` ุจุงุณุชุฎุฏุงู `db.getConnection()`

6. โ **ุนุฏู ุงูุชุญูู ูู ูุฌูุฏ `InventoryItem` ูุจู ุงูุฅูุดุงุก:**
   - **ุงููุดููุฉ:** ูุง ูุชู ุงูุชุญูู ูู ูุฌูุฏ `InventoryItem` ูุจู ุฅุถุงูุชู ููููู
   - **ุงูุญุงูุฉ:** โ **ุชู ุงูุฅุตูุงุญ**
   - **ุงูุญู ุงููุทุจู:** ุฅุถุงูุฉ validation ููุชุญูู ูู ูุฌูุฏ `InventoryItem` ูู `createStockTransfer`

### Frontend:
1. **ุนุฏู ูุฌูุฏ ุตูุญุฉ ุชูุงุตูู ุงูููู:**
   - **ุงููุดููุฉ:** ูุง ุชูุฌุฏ ุตูุญุฉ ูุฎุตุตุฉ ูุนุฑุถ ุชูุงุตูู ุงูููู
   - **ุงูุฃููููุฉ:** ูุชูุณุทุฉ (Medium)
   - **ุงูุญู ุงูููุชุฑุญ:** ุฅุถุงูุฉ ุตูุญุฉ `StockTransferDetailsPage`

2. **ุนุฏู ูุฌูุฏ validation ูู Frontend:**
   - **ุงููุดููุฉ:** ูุง ููุฌุฏ validation ุดุงูู ูู ุงูููุงุฐุฌ
   - **ุงูุฃููููุฉ:** ูุชูุณุทุฉ (Medium)
   - **ุงูุญู ุงูููุชุฑุญ:** ุฅุถุงูุฉ validation ููููุงุฐุฌ

---

## ๐ก ุงูุชุฑุงุญุงุช ุงูุชุญุณูู ูุงูุชุทููุฑ (ุงูุฃููููุงุช ุงููุชูุณุทุฉ ูุงูููุฎูุถุฉ)

### ุฃููููุฉ ูุชูุณุทุฉ:
1. **ุฅุถุงูุฉ Endpoint ููุจุญุซ:**
   - ุฅุถุงูุฉ search endpoint ููุจุญุซ ูู ุงููููุงุช
   - **ุงููุงุฆุฏุฉ:** ุชุณููู ุงูุจุญุซ ุนู ูููุงุช ูุนููุฉ

2. **ุฅุถุงูุฉ Sorting:**
   - ุฏุนู sorting ุญุณุจ ุงูุชุงุฑูุฎุ ุงูุญุงูุฉุ ุงููุฎุฒูุ ุฅูุฎ
   - **ุงููุงุฆุฏุฉ:** ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

3. **ุชุญุณูู Statistics:**
   - ุฅุถุงูุฉ ุฅุญุตุงุฆูุงุช ุฃูุซุฑ ุชูุตููุงู (ุนุฏุฏ ุงูุนูุงุตุฑ ุงููููููุฉุ ุฅุฌูุงูู ุงููููุฉุ ุฅูุฎ)
   - **ุงููุงุฆุฏุฉ:** ุฑุคูุฉ ุฃูุถู ููุฃุฏุงุก

4. **ุฅุถุงูุฉ Notifications:**
   - ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงูููู
   - **ุงููุงุฆุฏุฉ:** ุชุญุฏูุซ ููุฑู ูููุณุชุฎุฏููู

### ุฃููููุฉ ููุฎูุถุฉ:
5. **ุฅุถุงูุฉ Export:**
   - ุชุตุฏูุฑ ุงููููุงุช ุฅูู Excel/PDF
   - **ุงููุงุฆุฏุฉ:** ุชูุงุฑูุฑ ุฎุงุฑุฌูุฉ

6. **ุฅุถุงูุฉ History:**
   - ุญูุธ ุชุงุฑูุฎ ุงูุชุบููุฑุงุช ูู ุงูููู
   - **ุงููุงุฆุฏุฉ:** ุชุชุจุน ุฃูุถู

---

## ๐๏ธ ุฎุทุฉ ุงูุนูู ุงูููุฑูุฉ (ุฅุตูุงุญ ุงููุดุงูู ุงูุญุฑุฌุฉ)

### ุงููุฑุญูุฉ 1: ุฅุตูุงุญ ุงููุดุงูู ุงูุญุฑุฌุฉ
1. **ุฅุตูุงุญ Status Validation ูู `approveStockTransfer`:**
   - ุชุบููุฑ `'draft'` ุฅูู `'pending'`

2. **ุฅุตูุงุญ Validation Schemas:**
   - ุฌุนู `approvedBy`, `shippedBy` ุงุฎุชูุงุฑูุฉ ูู validation

### ุงููุฑุญูุฉ 2: ุฅุตูุงุญ ุงููุดุงูู ุนุงููุฉ ุงูุฃููููุฉ
3. **ุฅุถุงูุฉ Validation ูููููุฉ ุงููุชุงุญุฉ:**
   - ุงูุชุญูู ูู ุงููููุฉ ุงููุชุงุญุฉ ุนูุฏ ุงูุฅูุดุงุก ุฃู ุงูููุงููุฉ

4. **ุฅุถุงูุฉ Transactions:**
   - ุงุณุชุฎุฏุงู transactions ูู `createStockTransfer` ู `deleteStockTransfer`

5. **ุฅุถุงูุฉ Validation ููู InventoryItem:**
   - ุงูุชุญูู ูู ูุฌูุฏ `InventoryItem` ูุจู ุฅุถุงูุชู

### ุงููุฑุญูุฉ 3: ุงูุชุญุณููุงุช (ุจุนุฏ ุฅุตูุงุญ ุงููุดุงูู)
6. **ุชุญุณูู Frontend:**
   - ุฅุถุงูุฉ ุตูุญุฉ ุชูุงุตูู ุงูููู
   - ุฅุถุงูุฉ validation ูู ุงูููุงุฐุฌ

---

**ุงูุฎุทูุฉ ุงูุชุงููุฉ:** ุงูุจุฏุก ุจุชูููุฐ ุงูุฅุตูุงุญุงุช ุงูุญุฑุฌุฉ ุงููุฐููุฑุฉ ุฃุนูุงู ุซู ุงุฎุชุจุงุฑ ุงููุฏููู ุจุดูู ุดุงูู.

