# ุชูุฑูุฑ ุซุบุฑุฉ ุฃูููุฉ: xlsx Package

## ๐ ููุฎุต ุงููุดููุฉ

ุจุนุฏ ุชุดุบูู `npm audit fix`ุ ุชู ุฅุตูุงุญ 5 ุซุบุฑุงุช ุฃูููุฉุ ูููู ุชุจูู **ุซุบุฑุฉ ูุงุญุฏุฉ ุนุงููุฉ ุงูุฎุทูุฑุฉ** ูู package `xlsx`:

```
xlsx *
Severity: high
- Prototype Pollution in sheetJS
- SheetJS Regular Expression Denial of Service (ReDoS)
No fix available
```

**ุงูุญุงูุฉ:** โ ูุง ููุฌุฏ ุฅุตูุงุญ ูุชุงุญ (`No fix available`)

---

## ๐ ููุงูุน ุงุณุชุฎุฏุงู xlsx

ุชู ุงูุนุซูุฑ ุนูู `xlsx` ูุณุชุฎุฏู ูู:

1. **Backend:**
   - `backend/controllers/technicianReportsController.js` - ุชุตุฏูุฑ ุชูุงุฑูุฑ Excel

2. **Frontend:**
   - `frontend/react-app/src/services/exportService.js` - ุชุตุฏูุฑ ุงููุฏููุนุงุช ุฅูู Excel
   - `frontend/react-app/src/pages/inventory/ImportExportPage.js` - ุงุณุชูุฑุงุฏ/ุชุตุฏูุฑ ุงููุฎุฒูู

---

## โ๏ธ ุงููุฎุงุทุฑ

### 1. Prototype Pollution
- ูููู ููููุงุฌููู ุชุนุฏูู prototype objects ูู JavaScript
- ูุฏ ูุคุฏู ุฅูู code execution ุฃู data tampering
- ุฎุทูุฑ ุฎุงุตุฉ ุนูุฏ ูุนุงูุฌุฉ ูููุงุช Excel ูู ูุตุงุฏุฑ ุบูุฑ ููุซููุฉ

### 2. Regular Expression Denial of Service (ReDoS)
- ูููุงุช Excel ูุนูุฏุฉ ูููู ุฃู ุชุณุจุจ ุงุณุชููุงู CPU ุนุงูู ุฌุฏุงู
- ูุฏ ูุคุฏู ุฅูู DoS (Denial of Service) ุนูู ุงูุณูุฑูุฑ
- **ูุฐุง ูุฏ ูููู ูุฑุชุจุทุงู ุจูุดููุฉ CPU usage ุงูุชู ูุงุฌูุชูุง!**

---

## โ ุงูุญููู ุงูููุตู ุจูุง

### ุงูุญู 1: ุงุณุชุจุฏุงู xlsx ุจู ExcelJS (ููุตู ุจู)

**ExcelJS** ูู ุจุฏูู ุขูู ููุญุฏุซ:
- โ ูุง ุชูุฌุฏ ุซุบุฑุงุช ุฃูููุฉ ูุนุฑููุฉ
- โ API ูุดุงุจู ูู xlsx
- โ ุฃุฏุงุก ุฃูุถู
- โ ุฏุนู ุฃูุถู ููู styling ูุงูุชูุณูู

#### ููู Backend:
```bash
cd backend
npm uninstall xlsx
npm install exceljs
```

#### ููู Frontend:
```bash
cd frontend/react-app
npm uninstall xlsx
npm install exceljs
```

#### ูุซุงู ุนูู ุงูุงุณุชุจุฏุงู:

**ูุจู (xlsx):**
```javascript
const XLSX = require('xlsx');
const workbook = XLSX.read(data, { type: 'buffer' });
const worksheet = workbook.Sheets[workbook.SheetNames[0]];
const jsonData = XLSX.utils.sheet_to_json(worksheet);
```

**ุจุนุฏ (ExcelJS):**
```javascript
const ExcelJS = require('exceljs');
const workbook = new ExcelJS.Workbook();
await workbook.xlsx.load(data);
const worksheet = workbook.getWorksheet(1);
const jsonData = [];
worksheet.eachRow((row, rowNumber) => {
  jsonData.push(row.values);
});
```

---

### ุงูุญู 2: ุงุณุชุฎุฏุงู CSV ุจุฏูุงู ูู Excel (ุญูุซูุง ุฃููู)

ุฅุฐุง ูู ุชูู ููุงู ุญุงุฌุฉ ูู Excel formattingุ ูููู ุงุณุชุฎุฏุงู CSV:
- โ ุฃุจุณุท ูุฃุณุฑุน
- โ ูุง ุชูุฌุฏ ุซุบุฑุงุช ุฃูููุฉ
- โ ุฃุตุบุฑ ุญุฌูุงู

**ุงููุดุฑูุน ูุฏูู ุจุงููุนู `papaparse`** ููุชุนุงูู ูุน CSV:
```javascript
import Papa from 'papaparse';
// CSV parsing/exporting
```

---

### ุงูุญู 3: ุฅุถุงูุฉ Validation ู Rate Limiting (ูุคูุช)

ุฅุฐุง ูุงู ุงูุงุณุชุจุฏุงู ูุญุชุงุฌ ููุชุ ูููู ุชุทุจูู ุฅุฌุฑุงุกุงุช ูุคูุชุฉ:

#### ุฃ. ุชูููุฏ ุญุฌู ุงููููุงุช:
```javascript
// ูู multer config ุฃู validation middleware
const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB
if (file.size > MAX_FILE_SIZE) {
  throw new Error('File size exceeds limit');
}
```

#### ุจ. ุฅุถุงูุฉ Timeout:
```javascript
const timeout = setTimeout(() => {
  throw new Error('File processing timeout');
}, 30000); // 30 seconds

try {
  // Process Excel file
  const workbook = XLSX.read(data);
} finally {
  clearTimeout(timeout);
}
```

#### ุฌ. Validate File Structure:
```javascript
// ุงูุชุญูู ูู ุนุฏุฏ ุงูุตููู ูุงูุฃุนูุฏุฉ
const MAX_ROWS = 10000;
const MAX_COLS = 100;

if (worksheet.length > MAX_ROWS) {
  throw new Error('Too many rows');
}
```

---

## ๐ ุฎุทุฉ ุงูุชูููุฐ ุงูููุตู ุจูุง

### ุงููุฑุญูุฉ 1: ุงูุชูููู (ููุฑู)
1. โ ุชุญุฏูุฏ ุฌููุน ุงุณุชุฎุฏุงูุงุช xlsx (ุชู)
2. โณ ุชูููู ูุฏู ุชุนููุฏ ุงูุงุณุชุจุฏุงู
3. โณ ุชุญุฏูุฏ ุฃููููุงุช ุงููููุงุช ููุงุณุชุจุฏุงู

### ุงููุฑุญูุฉ 2: ุงูุงุณุชุจุฏุงู ุงูุชุฏุฑูุฌู

#### ุงูุฃููููุฉ ุงูุนุงููุฉ (ูุฌุจ ุฅุตูุงุญูุง ููุฑุงู):
- `frontend/react-app/src/pages/inventory/ImportExportPage.js`
  - **ุงูุณุจุจ:** ูุณุชูุจู ูููุงุช ูู ุงููุณุชุฎุฏููู (ูุตุฏุฑ ุบูุฑ ููุซูู)
  - **ุงููุฎุงุทุฑ:** Prototype Pollution + ReDoS

#### ุงูุฃููููุฉ ุงููุชูุณุทุฉ:
- `frontend/react-app/src/services/exportService.js`
  - **ุงูุณุจุจ:** ุชุตุฏูุฑ ููุท (ุฃูู ุฎุทูุฑุฉ)
  - **ูููู ุงูุงูุชุธุงุฑ:** ููู ูุฌุจ ุฅุตูุงุญู ูุฑูุจุงู

#### ุงูุฃููููุฉ ุงูููุฎูุถุฉ:
- `backend/controllers/technicianReportsController.js`
  - **ุงูุณุจุจ:** ุชุตุฏูุฑ ุฏุงุฎูู (ุฃูู ุฎุทูุฑุฉ)
  - **ูููู ุงูุงูุชุธุงุฑ:** ููู ูุฌุจ ุฅุตูุงุญู

### ุงููุฑุญูุฉ 3: ุงูุชูููุฐ

```bash
# 1. ุชุซุจูุช ExcelJS ูู Backend
cd backend
npm install exceljs

# 2. ุชุซุจูุช ExcelJS ูู Frontend
cd ../frontend/react-app
npm install exceljs

# 3. ุงุณุชุจุฏุงู xlsx ุจู ExcelJS ูู ุงููููุงุช
# (ูุญุชุงุฌ ุชุนุฏููุงุช ูู ุงูููุฏ)
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

### 1. ReDoS ู CPU Usage
โ๏ธ **ูุฐุง ููู ุฌุฏุงู!** ุซุบุฑุฉ ReDoS ูู xlsx ูุฏ ุชููู **ุณุจุจ ูุดููุฉ CPU usage ุงูุนุงูู** ุงูุชู ูุงุฌูุชูุง ุนูู VPS!

ุฅุฐุง ูุงู ุงููุณุชุฎุฏููู ูุฑูุนูู ูููุงุช Excel ูุจูุฑุฉ ุฃู ูุนูุฏุฉุ ูุฏ ูุณุจุจ ReDoS ุงุณุชููุงู CPU ุนุงูู ุฌุฏุงู.

### 2. Prototype Pollution
โ๏ธ ุฅุฐุง ูุงู ุงูุชุทุจูู ูุณุชูุจู ูููุงุช Excel ูู ูุณุชุฎุฏููู ุฎุงุฑุฌููู (ูุซู ImportExportPage)ุ ููุฐุง ุฎุทุฑ ุฃููู ุญูููู.

### 3. Rate Limiting
โ ุชู ุชูุนูู Rate Limiting ูู ุงูุฅุตูุงุญุงุช ุงูุณุงุจูุฉ - ูุฐุง ูุณุงุนุฏ ููู ูุง ูุญู ุงููุดููุฉ ุงูุฃุณุงุณูุฉ.

---

## ๐ ุฅุฌุฑุงุกุงุช ุฃูููุฉ ููุฑูุฉ (ูุคูุชุฉ)

ุจูููุง ูุชู ุงูุชุฎุทูุท ููุงุณุชุจุฏุงู ุงููุงูู:

1. **ุชูููุฏ ุญุฌู ุงููููุงุช:**
   - ุฅุถุงูุฉ validation ูุญุฌู ุงูููู (ูุซูุงู 5MB)
   - ุฑูุถ ุงููููุงุช ุงููุจูุฑุฉ

2. **Rate Limiting ุนูู Upload:**
   - ุงูุชุฃูุฏ ูู ุฃู upload limiter ููุนู (ุชู ุชูุนููู)
   - ุชูููู ุนุฏุฏ ุงููุญุงููุงุช ุงููุณููุญ ุจูุง

3. **Timeout ุนูู Processing:**
   - ุฅุถุงูุฉ timeout (30 ุซุงููุฉ) ููุนุงูุฌุฉ ุงููููุงุช
   - ุฅูุบุงุก ุงูุนูููุฉ ุฅุฐุง ุชุฌุงูุฒุช ุงูููุช

4. **Logging:**
   - ุชุณุฌูู ุฌููุน ูุญุงููุงุช ุฑูุน ูููุงุช Excel
   - ูุฑุงูุจุฉ ุงุณุชููุงู CPU ุฃุซูุงุก ูุนุงูุฌุฉ ุงููููุงุช

---

## โจ ุงูุฎูุงุตุฉ

- โ ุชู ุฅุตูุงุญ 5 ุซุบุฑุงุช (js-yaml, jws, nodemailer, validator)
- โ ุชุจูู ุซุบุฑุฉ ูุงุญุฏุฉ ุนุงููุฉ ุงูุฎุทูุฑุฉ ูู `xlsx`
- โ๏ธ **ูุฏ ุชููู ูุฑุชุจุทุฉ ุจูุดููุฉ CPU usage!**
- โ ุงูุญู ุงูููุตู ุจู: ุงุณุชุจุฏุงู ุจู ExcelJS
- โฐ ูุฌุจ ูุนุงูุฌุชูุง ูู ุฃูุฑุจ ููุช ูููู

**ุงูุฃููููุฉ:** ๐ด ุนุงููุฉ ุฌุฏุงู - ุฎุงุตุฉ ูู ImportExportPage

---

**ุชุงุฑูุฎ ุงูุชูุฑูุฑ:** $(date)
**ุงูุญุงูุฉ:** โ๏ธ ูุญุชุงุฌ ุฅุฌุฑุงุก ููุฑู

