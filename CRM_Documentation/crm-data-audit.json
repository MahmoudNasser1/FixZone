{
  "تاريخ_التدقيق": "2025-10-02",
  "الإصدار": "1.0",
  "حالة_التدقيق": "للقراءة فقط - لا تعديل على البيانات",
  "ملخص_عام": {
    "إجمالي_العملاء": 10,
    "إجمالي_الشركات": 6,
    "عملاء_مرتبطين_بشركات": 6,
    "عملاء_أفراد": 4,
    "إجمالي_طلبات_الإصلاح": 6,
    "فواتير_نشطة": "غير محسوبة - تحتاج استعلام DB"
  },
  
  "تحليل_جدول_العملاء": {
    "اسم_الجدول": "Customer",
    "الحقول_الرئيسية": {
      "id": "Primary Key - Auto Increment",
      "firstName": "Required - نص",
      "lastName": "Required - نص",
      "phone": "Required - نص",
      "email": "Optional - نص",
      "address": "Optional - نص طويل",
      "companyId": "Optional - Foreign Key → Company",
      "isActive": "Boolean - افتراضي TRUE",
      "status": "ENUM(active, inactive, blocked) - افتراضي active",
      "notes": "Optional - نص طويل",
      "createdAt": "Timestamp",
      "updatedAt": "Timestamp",
      "deletedAt": "Timestamp - للحذف المنطقي"
    },
    "الفهارس_الموجودة": [
      "PRIMARY KEY (id)",
      "INDEX idx_customer_phone (phone)",
      "INDEX idx_customer_company (companyId)",
      "FOREIGN KEY (companyId) REFERENCES Company(id) ON DELETE SET NULL"
    ],
    "مشاكل_جودة_البيانات": {
      "حقول_مفقودة_محتملة": [
        {
          "المشكلة": "لا يوجد حقل للجنس (Gender)",
          "الأولوية": "منخفضة",
          "التوصية": "إضافة ENUM('male', 'female', 'other', 'unknown') للتسويق المستهدف"
        },
        {
          "المشكلة": "لا يوجد حقل لتاريخ الميلاد",
          "الأولوية": "متوسطة",
          "التوصية": "إضافة birthDate DATE لحملات أعياد الميلاد"
        },
        {
          "المشكلة": "لا يوجد حقل لتصنيف العميل (Segment)",
          "الأولوية": "عالية",
          "التوصية": "إضافة segment ENUM('vip', 'regular', 'new', 'at_risk', 'inactive')"
        },
        {
          "المشكلة": "لا يوجد حقل لمصدر العميل (Lead Source)",
          "الأولوية": "عالية",
          "التوصية": "إضافة leadSource VARCHAR(50) مثل 'facebook', 'google', 'referral', 'walk-in'"
        },
        {
          "المشكلة": "لا يوجد حقل لتقييم العميل (Rating)",
          "الأولوية": "متوسطة",
          "التوصية": "إضافة rating TINYINT(1-5) لتقييم تجربة العميل"
        },
        {
          "المشكلة": "لا يوجد حقل للرقم الوطني أو الهوية",
          "الأولوية": "منخفضة",
          "التوصية": "إضافة nationalId VARCHAR(50) للشركات الكبرى"
        },
        {
          "المشكلة": "لا يوجد حقل لطريقة التواصل المفضلة",
          "الأولوية": "عالية",
          "التوصية": "إضافة preferredContactMethod ENUM('phone', 'email', 'whatsapp', 'sms')"
        },
        {
          "المشكلة": "لا يوجد حقل لآخر تفاعل",
          "الأولوية": "عالية",
          "التوصية": "إضافة lastInteractionDate TIMESTAMP لتتبع النشاط"
        },
        {
          "المشكلة": "لا يوجد حقل لإجمالي الإنفاق",
          "الأولوية": "عالية",
          "التوصية": "إضافة totalSpent DECIMAL(10,2) - يمكن حسابها ديناميكياً أو تخزينها"
        },
        {
          "المشكلة": "لا يوجد حقل لعدد الزيارات",
          "الأولوية": "متوسطة",
          "التوصية": "إضافة visitCount INT لتتبع التردد"
        }
      ],
      "مشاكل_البيانات_الموجودة": [
        {
          "المشكلة": "احتمالية وجود أرقام هواتف مكررة",
          "الأولوية": "عالية",
          "الاستعلام_المطلوب": "SELECT phone, COUNT(*) as count FROM Customer WHERE deletedAt IS NULL GROUP BY phone HAVING count > 1",
          "التوصية": "فحص وتوحيد السجلات المكررة"
        },
        {
          "المشكلة": "احتمالية وجود بريد إلكتروني مكرر",
          "الأولوية": "متوسطة",
          "الاستعلام_المطلوب": "SELECT email, COUNT(*) as count FROM Customer WHERE email IS NOT NULL AND email != '' AND deletedAt IS NULL GROUP BY email HAVING count > 1",
          "التوصية": "فحص وتوحيد السجلات المكررة"
        },
        {
          "المشكلة": "عملاء بدون بريد إلكتروني",
          "الأولوية": "منخفضة",
          "الاستعلام_المطلوب": "SELECT COUNT(*) FROM Customer WHERE (email IS NULL OR email = '') AND deletedAt IS NULL",
          "التوصية": "حملة لتحديث بيانات العملاء"
        },
        {
          "المشكلة": "عملاء بدون عنوان",
          "الأولوية": "منخفضة",
          "الاستعلام_المطلوق": "SELECT COUNT(*) FROM Customer WHERE (address IS NULL OR address = '') AND deletedAt IS NULL",
          "التوصية": "حملة لتحديث بيانات العملاء"
        },
        {
          "المشكلة": "عملاء غير نشطين (status = inactive)",
          "الأولوية": "متوسطة",
          "الاستعلام_المطلوب": "SELECT COUNT(*) FROM Customer WHERE status = 'inactive' AND deletedAt IS NULL",
          "التوصية": "حملة لإعادة تفعيل العملاء"
        }
      ],
      "مشاكل_التطبيع": [
        {
          "المشكلة": "لا يوجد جدول منفصل للعناوين",
          "الأولوية": "منخفضة",
          "التوصية": "للأنظمة الكبيرة: إنشاء جدول CustomerAddress للعملاء بعناوين متعددة"
        },
        {
          "المشكلة": "لا يوجد جدول منفصل لأرقام الهواتف",
          "الأولوية": "منخفضة",
          "التوصية": "للأنظمة الكبيرة: إنشاء جدول CustomerPhone للعملاء بأرقام متعددة"
        },
        {
          "المشكلة": "حقل notes نص حر بدون هيكلة",
          "الأولوية": "متوسطة",
          "التوصية": "الاحتفاظ بـ notes + إنشاء جدول CustomerNote منفصل للملاحظات المهيكلة"
        }
      ]
    }
  },
  
  "تحليل_جدول_الشركات": {
    "اسم_الجدول": "Company",
    "الحقول_الرئيسية": {
      "id": "Primary Key - Auto Increment",
      "name": "Required - نص",
      "contactPerson": "Optional - نص",
      "phone": "Optional - نص",
      "email": "Optional - نص",
      "address": "Optional - نص طويل",
      "taxNumber": "Optional - نص",
      "notes": "Optional - نص طويل",
      "isActive": "Boolean - افتراضي TRUE",
      "createdAt": "Timestamp",
      "updatedAt": "Timestamp",
      "deletedAt": "Timestamp - للحذف المنطقي"
    },
    "مشاكل_جودة_البيانات": {
      "حقول_مفقودة_محتملة": [
        {
          "المشكلة": "لا يوجد حقل للصناعة (Industry)",
          "الأولوية": "عالية",
          "التوصية": "إضافة industry VARCHAR(100) للتصنيف"
        },
        {
          "المشكلة": "لا يوجد حقل للموقع الإلكتروني",
          "الأولوية": "متوسطة",
          "التوصية": "إضافة website VARCHAR(255)"
        },
        {
          "المشكلة": "لا يوجد حقل لعدد الموظفين",
          "الأولوية": "منخفضة",
          "التوصية": "إضافة employeesCount INT"
        },
        {
          "المشكلة": "لا يوجد حقل لتاريخ التأسيس",
          "الأولوية": "منخفضة",
          "التوصية": "إضافة foundedYear YEAR"
        },
        {
          "المشكلة": "لا يوجد حقل لنوع الشركة (B2B/B2C)",
          "الأولوية": "متوسطة",
          "التوصية": "إضافة companyType ENUM('B2B', 'B2C', 'B2G')"
        },
        {
          "المشكلة": "لا يوجد حقل للحجم (Size)",
          "الأولوية": "متوسطة",
          "التوصية": "إضافة size ENUM('small', 'medium', 'large', 'enterprise')"
        },
        {
          "المشكلة": "لا يوجد حقل لشخص التواصل الثاني",
          "الأولوية": "منخفضة",
          "التوصية": "إنشاء جدول CompanyContact منفصل"
        }
      ],
      "مشاكل_البيانات_الموجودة": [
        {
          "المشكلة": "احتمالية وجود أسماء شركات مكررة",
          "الأولوية": "عالية",
          "الاستعلام_المطلوب": "SELECT name, COUNT(*) as count FROM Company WHERE deletedAt IS NULL GROUP BY name HAVING count > 1",
          "التوصية": "فحص وتوحيد الشركات المكررة"
        },
        {
          "المشكلة": "شركات بدون رقم ضريبي",
          "الأولوية": "متوسطة",
          "الاستعلام_المطلوب": "SELECT COUNT(*) FROM Company WHERE (taxNumber IS NULL OR taxNumber = '') AND deletedAt IS NULL",
          "التوصية": "حملة لتحديث بيانات الشركات"
        }
      ]
    }
  },
  
  "تحليل_العلاقات_الموجودة": {
    "علاقات_مُطبقة": [
      {
        "من": "Customer",
        "إلى": "Company",
        "نوع_العلاقة": "Many-to-One",
        "الحقل": "companyId",
        "القيد": "FOREIGN KEY ON DELETE SET NULL",
        "الحالة": "✅ يعمل بشكل صحيح"
      },
      {
        "من": "RepairRequest",
        "إلى": "Customer",
        "نوع_العلاقة": "Many-to-One",
        "الحقل": "customerId",
        "القيد": "FOREIGN KEY",
        "الحالة": "✅ يعمل بشكل صحيح"
      },
      {
        "من": "Invoice",
        "إلى": "Customer",
        "نوع_العلاقة": "Many-to-One",
        "الحقل": "customerId",
        "القيد": "FOREIGN KEY",
        "الحالة": "✅ يعمل بشكل صحيح"
      },
      {
        "من": "Invoice",
        "إلى": "RepairRequest",
        "نوع_العلاقة": "One-to-One",
        "الحقل": "repairRequestId",
        "القيد": "FOREIGN KEY",
        "الحالة": "✅ يعمل بشكل صحيح"
      },
      {
        "من": "Payment",
        "إلى": "Invoice",
        "نوع_العلاقة": "Many-to-One",
        "الحقل": "invoiceId",
        "القيد": "FOREIGN KEY ON DELETE CASCADE",
        "الحالة": "✅ يعمل بشكل صحيح"
      }
    ],
    "علاقات_مفقودة_للـCRM": [
      {
        "من": "CustomerInteraction (جدول جديد)",
        "إلى": "Customer",
        "نوع_العلاقة": "Many-to-One",
        "الأولوية": "عالية جداً",
        "التوصية": "تتبع جميع التفاعلات: مكالمات، رسائل، اجتماعات، شكاوى"
      },
      {
        "من": "CustomerNote (جدول جديد)",
        "إلى": "Customer",
        "نوع_العلاقة": "Many-to-One",
        "الأولوية": "عالية",
        "التوصية": "ملاحظات مهيكلة مع مستخدم وتاريخ"
      },
      {
        "من": "CustomerTag (جدول جديد)",
        "إلى": "Customer",
        "نوع_العلاقة": "Many-to-Many",
        "الأولوية": "عالية",
        "التوصية": "تصنيف العملاء بوسوم مخصصة"
      },
      {
        "من": "CustomerDocument (جدول جديد)",
        "إلى": "Customer",
        "نوع_العلاقة": "Many-to-One",
        "الأولوية": "متوسطة",
        "التوصية": "تخزين مستندات العملاء: عقود، اتفاقيات، هويات"
      },
      {
        "من": "FollowUpTask (جدول جديد)",
        "إلى": "Customer",
        "نوع_العلاقة": "Many-to-One",
        "الأولوية": "عالية جداً",
        "التوصية": "مهام المتابعة والتذكيرات"
      },
      {
        "من": "CustomerFeedback (جدول جديد)",
        "إلى": "Customer",
        "نوع_العلاقة": "Many-to-One",
        "الأولوية": "عالية",
        "التوصية": "تقييمات وآراء العملاء"
      }
    ]
  },
  
  "تحليل_البيانات_التاريخية": {
    "البيانات_المتاحة": {
      "RepairRequest": {
        "الوصف": "سجل كامل لطلبات الإصلاح",
        "الأهمية_لـCRM": "عالية جداً",
        "الحقول_المفيدة": [
          "receivedAt - تاريخ الطلب",
          "completedAt - تاريخ الإكمال",
          "status - الحالة",
          "estimatedCost - التكلفة المقدرة",
          "actualCost - التكلفة الفعلية",
          "priority - الأولوية"
        ],
        "الاستخدام_في_CRM": "حساب معدل التردد، متوسط الإنفاق، أنواع الأجهزة المفضلة"
      },
      "Invoice": {
        "الوصف": "سجل الفواتير",
        "الأهمية_لـCRM": "عالية جداً",
        "الحقول_المفيدة": [
          "issueDate - تاريخ الإصدار",
          "dueDate - تاريخ الاستحقاق",
          "paidDate - تاريخ الدفع",
          "status - حالة الدفع",
          "finalAmount - المبلغ النهائي"
        ],
        "الاستخدام_في_CRM": "حساب Customer Lifetime Value، تحليل الديون، معدل الدفع"
      },
      "Payment": {
        "الوصف": "سجل المدفوعات",
        "الأهمية_لـCRM": "عالية",
        "الحقول_المفيدة": [
          "amount - المبلغ",
          "paymentMethod - طريقة الدفع",
          "paymentDate - تاريخ الدفع"
        ],
        "الاستخدام_في_CRM": "تحليل سلوك الدفع، الطرق المفضلة"
      },
      "StatusUpdateLog": {
        "الوصف": "سجل تغييرات الحالات",
        "الأهمية_لـCRM": "متوسطة",
        "الحقول_المفيدة": [
          "oldStatus - الحالة القديمة",
          "newStatus - الحالة الجديدة",
          "updatedAt - وقت التحديث",
          "notes - ملاحظات"
        ],
        "الاستخدام_في_CRM": "تحليل مدة كل مرحلة، نقاط الاختناق"
      }
    },
    "البيانات_المفقودة": {
      "تفاعلات_العملاء": {
        "الوصف": "لا يوجد سجل للمكالمات أو الرسائل أو الاجتماعات",
        "الأولوية": "عالية جداً",
        "التأثير": "لا يمكن تتبع رحلة العميل الكاملة"
      },
      "رضا_العملاء": {
        "الوصف": "لا يوجد نظام لقياس رضا العملاء",
        "الأولوية": "عالية",
        "التأثير": "لا يمكن تحديد العملاء المعرضين للمغادرة"
      },
      "حملات_التسويق": {
        "الوصف": "لا يوجد تتبع لحملات التسويق ومصادر العملاء",
        "الأولوية": "عالية",
        "التأثير": "لا يمكن قياس ROI للتسويق"
      }
    }
  },
  
  "توصيات_التطهير": {
    "عاجلة": [
      {
        "المهمة": "فحص وتوحيد أرقام الهواتف المكررة",
        "الاستعلام": "SELECT phone, GROUP_CONCAT(id) as ids, COUNT(*) as count FROM Customer WHERE deletedAt IS NULL GROUP BY phone HAVING count > 1",
        "الإجراء": "مراجعة يدوية + دمج السجلات"
      },
      {
        "المهمة": "توحيد تنسيق أرقام الهواتف",
        "الاستعلام": "SELECT id, phone FROM Customer WHERE phone NOT REGEXP '^[0-9+\\-\\s()]+$'",
        "الإجراء": "تطبيق معيار موحد: +20XXXXXXXXXX"
      },
      {
        "المهمة": "التحقق من صحة البريد الإلكتروني",
        "الاستعلام": "SELECT id, email FROM Customer WHERE email IS NOT NULL AND email NOT REGEXP '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}$'",
        "الإجراء": "تصحيح أو حذف البريد غير الصحيح"
      }
    ],
    "قصيرة_المدى": [
      {
        "المهمة": "تحديد العملاء غير النشطين",
        "الاستعلام": "SELECT c.id, c.firstName, c.lastName, MAX(r.receivedAt) as lastActivity FROM Customer c LEFT JOIN RepairRequest r ON c.id = r.customerId WHERE c.deletedAt IS NULL GROUP BY c.id HAVING lastActivity < DATE_SUB(NOW(), INTERVAL 90 DAY) OR lastActivity IS NULL",
        "الإجراء": "تطبيق segment = 'inactive' أو 'at_risk'"
      },
      {
        "المهمة": "تحديد العملاء VIP",
        "الاستعلام": "SELECT c.id, c.firstName, c.lastName, SUM(i.finalAmount) as totalSpent, COUNT(r.id) as repairCount FROM Customer c LEFT JOIN RepairRequest r ON c.id = r.customerId LEFT JOIN Invoice i ON r.id = i.repairRequestId WHERE c.deletedAt IS NULL GROUP BY c.id HAVING totalSpent > 5000 OR repairCount > 10",
        "الإجراء": "تطبيق segment = 'vip'"
      }
    ],
    "متوسطة_المدى": [
      {
        "المهمة": "استكمال البيانات الناقصة",
        "الوصف": "حملة لجمع البريد الإلكتروني، العنوان، تاريخ الميلاد",
        "الطريقة": "رسائل واتساب أو مكالمات عند الزيارة القادمة"
      },
      {
        "المهمة": "تصنيف العملاء الحاليين",
        "الوصف": "تطبيق التصنيفات: VIP, Regular, New, At Risk, Inactive",
        "الطريقة": "باستخدام خوارزمية RFM (Recency, Frequency, Monetary)"
      }
    ]
  },
  
  "مقاييس_الجودة": {
    "الاكتمال": {
      "phone": "100% - مطلوب",
      "email": "تقدير 40% - يحتاج تحسين",
      "address": "تقدير 60% - مقبول",
      "companyId": "60% مرتبطين - جيد"
    },
    "الدقة": {
      "phone_format": "يحتاج توحيد",
      "email_format": "يحتاج تحقق",
      "duplicates": "يحتاج فحص"
    },
    "التوقيت": {
      "updatedAt": "يتم التحديث تلقائياً",
      "lastInteractionDate": "غير موجود - يجب إضافته"
    },
    "الصلاحية": {
      "soft_delete": "✅ مُطبق",
      "status": "✅ يستخدم بشكل صحيح",
      "active_validation": "✅ موجود"
    }
  },
  
  "ملاحظات_الأمان": {
    "البيانات_الحساسة": [
      "أرقام الهواتف",
      "البريد الإلكتروني",
      "العناوين",
      "الأرقام الوطنية (إذا أُضيفت)",
      "البيانات المالية"
    ],
    "التوصيات_الأمنية": [
      "تشفير أرقام الهواتف في حالة الراحة",
      "تطبيق RBAC صارم على بيانات العملاء",
      "تسجيل جميع عمليات الوصول (Audit Log)",
      "تطبيق Data Masking للمستخدمين غير المصرح لهم",
      "نسخ احتياطية مشفرة يومية",
      "سياسة الاحتفاظ بالبيانات (GDPR-like)"
    ]
  },
  
  "خلاصة_التدقيق": {
    "الحالة_العامة": "جيد - البنية الأساسية سليمة",
    "نقاط_القوة": [
      "قاعدة بيانات منظمة ومفهرسة",
      "علاقات مُطبقة بشكل صحيح",
      "نظام Soft Delete للحفاظ على البيانات",
      "Timestamps تلقائية",
      "Foreign Keys مع ON DELETE واضحة"
    ],
    "نقاط_التحسين": [
      "إضافة حقول CRM إضافية",
      "إنشاء جداول التفاعلات والملاحظات",
      "تطبيق نظام التصنيف (Segmentation)",
      "تطبيق نظام التقييم (Rating/Feedback)",
      "إضافة حقول تتبع النشاط",
      "توحيد تنسيق البيانات",
      "إكمال البيانات الناقصة"
    ],
    "الإجراءات_العاجلة": [
      "فحص التكرارات في أرقام الهواتف",
      "توحيد تنسيق أرقام الهواتف",
      "التحقق من صحة البريد الإلكتروني",
      "تصنيف العملاء الحاليين (RFM)"
    ],
    "جاهزية_النظام_لـCRM": "70% - يحتاج توسعات للكيانات الجديدة"
  }
}

