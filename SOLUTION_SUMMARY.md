# โ ุญู ููุงุฆู ููุดููุฉ Insufficient Stock Quantity

## ๐ ุงููุดููุฉ ุงูุฃุตููุฉ
- **ุงูุฎุทุฃ**: 409 Conflict - "Insufficient stock quantity"
- **ุงูุณููู**: ุงููุธุงู ูุฑูุถ ุตุฑู ูุทุน ุฅุฐุง ูู ููู ููุงู ูุฎุฒูู ูุงูู
- **ุงูุชุฃุซูุฑ**: ูุง ูููู ุตุฑู ูุทุน ููุฅุตูุงุญุงุช ุงูุนุงุฌูุฉ

---

## โ ุงูุญู ุงููุทุจู

### **1. ุงูุชุญูู ูู ุงููุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู**
```javascript
// ูุจู ุฑูุถ ุงูุนูููุฉุ ูุชุญูู ุงููุธุงู ูู ูุฌูุฏ ูุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู
const [otherStock] = await conn.query(
  'SELECT warehouseId, quantity, w.name as warehouseName 
   FROM StockLevel sl 
   LEFT JOIN Warehouse w ON sl.warehouseId = w.id 
   WHERE sl.inventoryItemId = ? AND sl.quantity > 0',
  [inventoryItemId]
);
```

**ุงููุชูุฌุฉ**: ุฅุฐุง ููุฌุฏ ูุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑูุ ุชูุนุงุฏ ุฑุณุงูุฉ ุชูุถูุญูุฉ ูุน ุงูุชุฑุงุญ ููู ุงููุฎุฒูู.

---

### **2. ุงูุณูุงุญ ุจุงูุตุฑู ุญุชู ูุน ุนุฏู ูุฌูุฏ ูุฎุฒูู**
```javascript
// ุฅุฐุง ูู ููู ููุงู ูุฎุฒูู ููุงุฆูุงูุ ูุณูุญ ุงููุธุงู ุจุงูุตุฑู
// (ููุฅุตูุงุญุงุช ุงูุนุงุฌูุฉ - ุณูุคุฏู ููุฎุฒูู ุณุงูุจ)
if (otherWarehousesStock.length === 0 && currentQty === 0) {
  // Allow issuing with zero stock - this will go negative
  console.warn(`โ๏ธ Issuing part with zero stock`);
  // Continue with the process
}
```

**ุงููุชูุฌุฉ**: 
- โ ุงูุณูุงุญ ุจุงูุฅุตูุงุญุงุช ุงูุนุงุฌูุฉ
- โ๏ธ ุชุญุฐูุฑ ูุงุถุญ ูู ุงูู response
- ๐ ุชุณุฌูู ูู logs ูููุชุงุจุนุฉ

---

### **3. ุชุญุฐูุฑ ูุงุถุญ ุนูุฏ ุงููุฎุฒูู ุงูุณุงูุจ**
```javascript
const isNegativeStock = newQty < 0;

// ูู ุงูู response:
warning: isNegativeStock ? {
  message: `โ๏ธ ุชุญุฐูุฑ: ุงููุฎุฒูู ุฃุตุจุญ ุณุงูุจุงู (${newQty}). ูุฑุฌู ุชุตุญูุญ ุงููุฎุฒูู ุนุจุฑ ุฅุถุงูุฉ ูุฎุฒูู ุฌุฏูุฏ.`,
  newQuantity: newQty,
  actionRequired: 'add_stock'
} : null
```

**ุงููุชูุฌุฉ**: 
- โ ุฑุณุงูุฉ ุชุญุฐูุฑ ูุงุถุญุฉ ูููุณุชุฎุฏู
- โ ูุนูููุงุช ุนู ุงููููุฉ ุงูุฌุฏูุฏุฉ
- โ ุฅุฑุดุงุฏุงุช ููุนูู ุงููุทููุจ

---

## ๐ ุงูุณููุงุฑูููุงุช ุงููุญุชููุฉ

### **ุงูุณููุงุฑูู 1: ููุฌุฏ ูุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู**
```json
{
  "success": false,
  "status": 409,
  "message": "ููุฌุฏ ูุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู. ููููู ููู ุงููุฎุฒูู ุฃู ุงุฎุชูุงุฑ ูุฎุฒู ุขุฎุฑ",
  "otherWarehousesStock": [
    {
      "warehouseId": 21,
      "warehouseName": "ูุฎุฒู ุงููุฑุน ุงูุซุงูู",
      "quantity": 10
    }
  ],
  "suggestion": "ููููู ููู ุงููุฎุฒูู ูู ูุฎุฒู ุขุฎุฑ ุฃู ุงุฎุชูุงุฑ ูุฎุฒู ุขุฎุฑ"
}
```

### **ุงูุณููุงุฑูู 2: ูุง ููุฌุฏ ูุฎุฒูู ููุงุฆูุงู - ุงูุณูุงุญ ุจุงูุตุฑู**
```json
{
  "success": true,
  "status": 201,
  "message": "ุชู ุตุฑู ุงููุทุนุฉ ุจูุฌุงุญ. โ๏ธ ุชุญุฐูุฑ: ุงููุฎุฒูู ุฃุตุจุญ ุณุงูุจุงู (-1). ูุฑุฌู ุชุตุญูุญ ุงููุฎุฒูู ูุงุญูุงู.",
  "warning": {
    "message": "โ๏ธ ุชุญุฐูุฑ: ุงููุฎุฒูู ุฃุตุจุญ ุณุงูุจุงู (-1). ูุฑุฌู ุชุตุญูุญ ุงููุฎุฒูู ุนุจุฑ ุฅุถุงูุฉ ูุฎุฒูู ุฌุฏูุฏ.",
    "newQuantity": -1,
    "actionRequired": "add_stock"
  },
  "data": {
    "stockLevel": {
      "quantity": -1,
      "isLowStock": true
    }
  }
}
```

### **ุงูุณููุงุฑูู 3: ููุฌุฏ ูุฎุฒูู ูุงูู**
```json
{
  "success": true,
  "status": 201,
  "message": "ุชู ุตุฑู ุงููุทุนุฉ ุจูุฌุงุญ",
  "warning": null,
  "data": {
    "stockLevel": {
      "quantity": 4,
      "isLowStock": false
    }
  }
}
```

---

## ๐ฏ ุงููุฒุงูุง

1. โ **ูุฑููุฉ ุฃูุจุฑ**: ุงูุณูุงุญ ุจุงูุฅุตูุงุญุงุช ุงูุนุงุฌูุฉ ุญุชู ุจุฏูู ูุฎุฒูู
2. โ **ุฑุณุงุฆู ูุงุถุญุฉ**: ุชูุถูุญ ุงููุถุน ูููุณุชุฎุฏู ุจุดูู ูุงูู
3. โ **ุงูุชุฑุงุญุงุช ูููุฏุฉ**: ุฅุธูุงุฑ ุงููุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู
4. โ **ุชุชุจุน ุฃูุถู**: ุชุญุฐูุฑุงุช ูุงุถุญุฉ ุนูุฏ ุงุณุชุฎุฏุงู ูุฎุฒูู ุณุงูุจ
5. โ **ูุง ุชุนุทู ุงูุนูู**: ุงูุณูุงุญ ุจุงูุตุฑู ููุฅุตูุงุญุงุช ุงูุนุงุฌูุฉ

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### **1. ุงููุฎุฒูู ุงูุณุงูุจ**
- ุงููุธุงู ูุณูุญ ุจุงููุฎุฒูู ุงูุณุงูุจ ููุฅุตูุงุญุงุช ุงูุนุงุฌูุฉ
- **ูุฌุจ ุชุตุญูุญ ุงููุฎุฒูู ูุงุญูุงู** ุนุจุฑ:
  - ุฅุถุงูุฉ ูุฎุฒูู ุฌุฏูุฏ
  - ุชุนุฏููุงุช ุงููุฎุฒูู ุงููุฏููุฉ
  - ููู ุงููุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู

### **2. ุงูุชุญูู ูู ุงููุฎุฒูู**
- ูุฌุจ ุนูู ุงููุณุชุฎุฏููู ุงูุชุญูู ูู ุงููุฎุฒูู ุงููุชุงุญ ูุจู ุงูุตุฑู
- ุฑุณุงุฆู ุงูุชุญุฐูุฑ ูุงุถุญุฉ ูููุตูุฉ

### **3. ุงููุฑุงูุจุฉ**
- ุฌููุน ุนูููุงุช ุงูุตุฑู ุจุงููุฎุฒูู ุงูุณุงูุจ ุชูุณุฌู ูู logs
- ูููู ุชุชุจุนูุง ูุฅุตูุงุญูุง ูุงุญูุงู

---

## ๐ ุงูุชุบููุฑุงุช ูู ุงูููุฏ

### **ููู: `backend/routes/inventoryIssue.js`**

1. **ุฅุถุงูุฉ ุงูุชุญูู ูู ูุฎุงุฒู ุฃุฎุฑู** (lines 70-80)
2. **ุงูุณูุงุญ ุจุงูุตุฑู ุจุฏูู ูุฎุฒูู** (lines 130-155)
3. **ุชุชุจุน ุงููุฎุฒูู ุงูุณุงูุจ** (lines 202-213)
4. **ุชุญุฐูุฑุงุช ูู ุงูู response** (lines 360-366)

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

โ **ุงููุธุงู ุงูุขู**:
- ูุนูู ุจุฏูู ุฃุฎุทุงุก (404 ุฃู 500)
- ูุณูุญ ุจุงูุตุฑู ุญุชู ุจุฏูู ูุฎุฒูู (ููุฅุตูุงุญุงุช ุงูุนุงุฌูุฉ)
- ูููุฑ ุฑุณุงุฆู ูุงุถุญุฉ ููููุฏุฉ
- ููุชุฑุญ ุญููู ุนูุฏ ูุฌูุฏ ูุฎุฒูู ูู ูุฎุงุฒู ุฃุฎุฑู
- ูุญุฐุฑ ูู ุงููุฎุฒูู ุงูุณุงูุจ ููุทูุจ ุงูุชุตุญูุญ

---

**ุชุงุฑูุฎ ุงูุชุทุจูู**: 22 ููููุจุฑ 2025  
**ุงูุญุงูุฉ**: โ ุชู ุงูุชุทุจูู ุจูุฌุงุญ - ุฌุงูุฒ ููุงุฎุชุจุงุฑ

