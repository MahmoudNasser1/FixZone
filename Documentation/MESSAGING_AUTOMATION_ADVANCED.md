# ๐๏ธ ุฅุนุฏุงุฏุงุช ุงูุฃุชูุชุฉ ุงููุชูุฏูุฉ - ูุธุงู ุงููุฑุงุณูุฉ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ุฅุนุฏุงุฏุงุช ูุชูุฏูุฉ ููุฃุชูุชุฉ ุชุชูุญ ุงูุชุญูู ุงูุฏููู ูู ูู ููุน ุฅุดุนุงุฑ ุนูู ุญุฏุฉ.

**ุชุงุฑูุฎ ุงูุฅุถุงูุฉ:** 2025-01-12  
**ุงูุญุงูุฉ:** โ ููุชูู

---

## ๐ฏ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ุชุญูู ุฏููู ูู ุฅุดุนุงุฑุงุช ุทูุจุงุช ุงูุฅุตูุงุญ

**ุงูุฅุนุฏุงุฏุงุช ุงููุชุงุญุฉ:**
- โ `notifyOnReceived` - ุฅุดุนุงุฑ ุนูุฏ ุงุณุชูุงู ุงูุทูุจ (RECEIVED)
- โ `notifyOnDiagnosed` - ุฅุดุนุงุฑ ุนูุฏ ุงูุชูุงู ุงูุชุดุฎูุต (INSPECTION)
- โ `notifyOnCompleted` - ุฅุดุนุงุฑ ุนูุฏ ุงูุชูุงู ุงูุฅุตูุงุญ (READY_FOR_DELIVERY/DELIVERED)
- โ `notifyOnReadyPickup` - ุฅุดุนุงุฑ ุนูุฏ ุฌุงูุฒูุฉ ุงูุงุณุชูุงู (READY_FOR_PICKUP)

**ุงูุงุณุชุฎุฏุงู:**
ููููู ุชูุนูู/ุชุนุทูู ูู ููุน ุฅุดุนุงุฑ ุนูู ุญุฏุฉ ูู ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช.

---

### 2. ุชุญูู ุฏููู ูู ุฅุดุนุงุฑุงุช ุงูููุงุชูุฑ

**ุงูุฅุนุฏุงุฏุงุช ุงููุชุงุญุฉ:**
- โ `notifyOnCreated` - ุฅุดุนุงุฑ ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ
- โ `notifyOnStatusChange` - ุฅุดุนุงุฑ ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงููุงุชูุฑุฉ (ููุฏ ุงูุชุทููุฑ)

**ุงูุงุณุชุฎุฏุงู:**
ููููู ุชูุนูู/ุชุนุทูู ุฅุดุนุงุฑุงุช ุงูููุงุชูุฑ ุจุดูู ูููุตู.

---

### 3. ุชุญูู ูุชูุฏู ูู ุชุฐููุฑุงุช ุงูุฏูุน

#### 3.1 ุชุฐููุฑุงุช ุงูุฏูุน ุงููุชุฃุฎุฑุฉ

**ุงูุฅุนุฏุงุฏุงุช:**
- โ `enabled` - ุชูุนูู/ุชุนุทูู ุงูุชุฐููุฑุงุช ุงููุชุฃุฎุฑุฉ
- โ `minDaysBetweenReminders` - ุงูุญุฏ ุงูุฃุฏูู ููุฃูุงู ุจูู ุงูุชุฐููุฑุงุช (ุงูุชุฑุงุถู: 1 ููู)

**ุงูููุฒุงุช:**
- ููููู ุชุนุทูู ุงูุชุฐููุฑุงุช ุงููุชุฃุฎุฑุฉ ุชูุงูุงู
- ููููู ุชุญุฏูุฏ ุนุฏุฏ ุงูุฃูุงู ุจูู ูู ุชุฐููุฑ (ูุซูุงู: 3 ุฃูุงู)

---

#### 3.2 ุชุฐููุฑุงุช ูุจู ุงูุงุณุชุญูุงู

**ุงูุฅุนุฏุงุฏุงุช:**
- โ `enabled` - ุชูุนูู/ุชุนุทูู ุงูุชุฐููุฑุงุช ูุจู ุงูุงุณุชุญูุงู
- โ `daysBeforeDue` - ุนุฏุฏ ุงูุฃูุงู ูุจู ุงูุงุณุชุญูุงู (ุงูุชุฑุงุถู: 3 ุฃูุงู)
- โ `minDaysBetweenReminders` - ุงูุญุฏ ุงูุฃุฏูู ููุฃูุงู ุจูู ุงูุชุฐููุฑุงุช (ุงูุชุฑุงุถู: 1 ููู)

**ุงูููุฒุงุช:**
- ููููู ุชุนุทูู ุงูุชุฐููุฑุงุช ูุจู ุงูุงุณุชุญูุงู ุชูุงูุงู
- ููููู ุชุญุฏูุฏ ุนุฏุฏ ุงูุฃูุงู ูุจู ุงูุงุณุชุญูุงู (ูุซูุงู: 5 ุฃูุงู ุจุฏูุงู ูู 3)
- ููููู ุชุญุฏูุฏ ุนุฏุฏ ุงูุฃูุงู ุจูู ูู ุชุฐููุฑ

---

## ๐ ูููู ุงูุฅุนุฏุงุฏุงุช

```json
{
  "automation": {
    "enabled": true,
    "defaultChannels": ["whatsapp", "email"],
    "invoice": {
      "notifyOnCreated": true,
      "notifyOnStatusChange": false
    },
    "repair": {
      "notifyOnReceived": true,
      "notifyOnDiagnosed": true,
      "notifyOnCompleted": true,
      "notifyOnReadyPickup": true
    },
    "payment": {
      "overdueReminders": {
        "enabled": true,
        "schedule": "0 9 * * *",
        "minDaysBetweenReminders": 1
      },
      "beforeDueReminders": {
        "enabled": true,
        "schedule": "0 10 * * *",
        "daysBeforeDue": 3,
        "minDaysBetweenReminders": 1
      }
    }
  }
}
```

---

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช

**ุงููููุน:** `/settings` โ ูุณู "ุฅุนุฏุงุฏุงุช ุงูุฃุชูุชุฉ (Automation)"

**ุงูุฃูุณุงู:**

1. **ุงููููุงุช ุงูุงูุชุฑุงุถูุฉ**
   - ุงุฎุชูุงุฑ ุงููููุงุช (ูุงุชุณุงุจ + Email)

2. **ุฅุดุนุงุฑุงุช ุงูููุงุชูุฑ**
   - Checkbox: ุฅุดุนุงุฑ ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ
   - Checkbox: ุฅุดุนุงุฑ ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงููุงุชูุฑุฉ

3. **ุฅุดุนุงุฑุงุช ุทูุจุงุช ุงูุฅุตูุงุญ**
   - Checkbox: ุฅุดุนุงุฑ ุนูุฏ ุงุณุชูุงู ุงูุทูุจ
   - Checkbox: ุฅุดุนุงุฑ ุนูุฏ ุงูุชูุงู ุงูุชุดุฎูุต
   - Checkbox: ุฅุดุนุงุฑ ุนูุฏ ุงูุชูุงู ุงูุฅุตูุงุญ
   - Checkbox: ุฅุดุนุงุฑ ุนูุฏ ุฌุงูุฒูุฉ ุงูุงุณุชูุงู

4. **ุชุฐููุฑุงุช ุงูุฏูุน**
   - ูุณู ุชุฐููุฑุงุช ุงููุชุฃุฎุฑุฉ:
     - Checkbox: ุชูุนูู/ุชุนุทูู
     - Input: ุงูุญุฏ ุงูุฃุฏูู ููุฃูุงู ุจูู ุงูุชุฐููุฑุงุช
   - ูุณู ุชุฐููุฑุงุช ูุจู ุงูุงุณุชุญูุงู:
     - Checkbox: ุชูุนูู/ุชุนุทูู
     - Input: ุนุฏุฏ ุงูุฃูุงู ูุจู ุงูุงุณุชุญูุงู
     - Input: ุงูุญุฏ ุงูุฃุฏูู ููุฃูุงู ุจูู ุงูุชุฐููุฑุงุช

---

## ๐ง Backend Implementation

### ุงูุชุญูู ูู ุงูุฅุนุฏุงุฏุงุช

**ูู `automation.service.js`:**

```javascript
// ูุซุงู: ุงูุชุญูู ูู ุฅุดุนุงุฑุงุช ุทูุจุงุช ุงูุฅุตูุงุญ
const settings = await settingsRepository.findByKey('messaging_settings');
const repairSettings = messagingSettings.automation?.repair;

if (newStatus === 'RECEIVED') {
  shouldNotify = repairSettings?.notifyOnReceived !== false; // Default: true
  // ...
}
```

**ุงูููู ุงูุงูุชุฑุงุถูุฉ:**
- ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ ุงูุฅุนุฏุงุฏุ ูุชู ุงุณุชุฎุฏุงู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ (true)
- ูููู ุชุนุทูู ุฃู ุฅุดุนุงุฑ ุจุณูููุฉ

---

## ๐ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### ูุซุงู 1: ุชุนุทูู ุฅุดุนุงุฑุงุช ุงูุชุดุฎูุต ููุท

```json
{
  "automation": {
    "enabled": true,
    "repair": {
      "notifyOnReceived": true,
      "notifyOnDiagnosed": false,  // ูุนุทู
      "notifyOnCompleted": true,
      "notifyOnReadyPickup": true
    }
  }
}
```

**ุงููุชูุฌุฉ:**
- โ ุฅุดุนุงุฑ ุนูุฏ ุงุณุชูุงู ุงูุทูุจ
- โ ูุง ุฅุดุนุงุฑ ุนูุฏ ุงูุชุดุฎูุต
- โ ุฅุดุนุงุฑ ุนูุฏ ุงูุชูุงู ุงูุฅุตูุงุญ
- โ ุฅุดุนุงุฑ ุนูุฏ ุฌุงูุฒูุฉ ุงูุงุณุชูุงู

---

### ูุซุงู 2: ุชุฐููุฑุงุช ูู 3 ุฃูุงู

```json
{
  "automation": {
    "payment": {
      "overdueReminders": {
        "enabled": true,
        "minDaysBetweenReminders": 3  // ูู 3 ุฃูุงู
      }
    }
  }
}
```

**ุงููุชูุฌุฉ:**
- โ ุชุฐููุฑ ููููุงุชูุฑ ุงููุชุฃุฎุฑุฉ
- โ ูุง ูุชู ุฅุฑุณุงู ุชุฐููุฑ ุฌุฏูุฏ ุฅูุง ุจุนุฏ 3 ุฃูุงู ูู ุขุฎุฑ ุชุฐููุฑ

---

### ูุซุงู 3: ุชุฐููุฑุงุช ูุจู 5 ุฃูุงู ูู ุงูุงุณุชุญูุงู

```json
{
  "automation": {
    "payment": {
      "beforeDueReminders": {
        "enabled": true,
        "daysBeforeDue": 5,  // 5 ุฃูุงู ุจุฏูุงู ูู 3
        "minDaysBetweenReminders": 2  // ูู ููููู
      }
    }
  }
}
```

**ุงููุชูุฌุฉ:**
- โ ุชุฐููุฑ ููููุงุชูุฑ ุงููุณุชุญูุฉ ุฎูุงู 5 ุฃูุงู
- โ ูุง ูุชู ุฅุฑุณุงู ุชุฐููุฑ ุฌุฏูุฏ ุฅูุง ุจุนุฏ ููููู ูู ุขุฎุฑ ุชุฐููุฑ

---

## โ ูุงุฆูุฉ ุงูุชุญูู

- [x] ุชุญูู ูู ุฅุดุนุงุฑุงุช ุทูุจุงุช ุงูุฅุตูุงุญ (4 ุญุงูุงุช)
- [x] ุชุญูู ูู ุฅุดุนุงุฑุงุช ุงูููุงุชูุฑ (2 ุฃููุงุน)
- [x] ุชุญูู ูู ุชุฐููุฑุงุช ุงูุฏูุน ุงููุชุฃุฎุฑุฉ
- [x] ุชุญูู ูู ุชุฐููุฑุงุช ูุจู ุงูุงุณุชุญูุงู
- [x] ุฅุนุฏุงุฏุงุช ุงูุญุฏ ุงูุฃุฏูู ููุฃูุงู ุจูู ุงูุชุฐููุฑุงุช
- [x] ุฅุนุฏุงุฏุงุช ุนุฏุฏ ุงูุฃูุงู ูุจู ุงูุงุณุชุญูุงู
- [x] ูุงุฌูุฉ ูุณุชุฎุฏู ูุชูุฏูุฉ ูู ุงููุฑููุช ุฅูุฏ
- [x] Backend ูุฏุนู ุฌููุน ุงูุฅุนุฏุงุฏุงุช

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ุชุนุทูู ุฅุดุนุงุฑ ูุนูู

1. ุงุฐูุจ ุฅูู `/settings`
2. ูู ูุณู "ุฅุดุนุงุฑุงุช ุทูุจุงุช ุงูุฅุตูุงุญ"
3. ุนุทูู "ุฅุดุนุงุฑ ุนูุฏ ุงูุชูุงู ุงูุชุดุฎูุต"
4. ุงุญูุธ ุงูุฅุนุฏุงุฏุงุช
5. ุบููุฑ ุญุงูุฉ ุทูุจ ุฅุตูุงุญ ุฅูู `INSPECTION`
6. ุชุญูู ูู:
   - โ ูุง ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ

---

### ุงุฎุชุจุงุฑ 2: ุชุฐููุฑุงุช ูุฎุตุตุฉ

1. ูู ูุณู "ุชุฐููุฑุงุช ุงูุฏูุน"
2. ุนููู "ุงูุญุฏ ุงูุฃุฏูู ุจูู ุงูุชุฐููุฑุงุช" = 3 ุฃูุงู
3. ุงุญูุธ ุงูุฅุนุฏุงุฏุงุช
4. ุดุบูู `checkOverduePayments()`
5. ุดุบูููุง ูุฑุฉ ุฃุฎุฑู ุจุนุฏ ููู ูุงุญุฏ
6. ุชุญูู ูู:
   - โ ูุง ูุชู ุฅุฑุณุงู ุชุฐููุฑ ุฌุฏูุฏ (ูู ููุฑ 3 ุฃูุงู)

---

## ๐ ุงููููุงุช ุงููุญุฏุซุฉ

1. **Frontend:**
   - `frontend/react-app/src/pages/settings/MessagingSettingsPage.js`
     - ุฅุถุงูุฉ ุฃูุณุงู ูุชูุฏูุฉ ููุฃุชูุชุฉ

2. **Backend:**
   - `backend/services/automation.service.js`
     - ุงูุชุญูู ูู ุงูุฅุนุฏุงุฏุงุช ุงููุญุฏุฏุฉ ููู ููุน ุฅุดุนุงุฑ
     - ุฏุนู ุงูุฅุนุฏุงุฏุงุช ุงููุชูุฏูุฉ ููุชุฐููุฑุงุช

3. **Scripts:**
   - `backend/scripts/setup-messaging-defaults.js`
     - ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ

---

## ๐ฏ ุงูููุงุฆุฏ

1. **ูุฑููุฉ ุฃูุจุฑ:**
   - ูููู ุชูุนูู/ุชุนุทูู ูู ููุน ุฅุดุนุงุฑ ุนูู ุญุฏุฉ
   - ูุง ุญุงุฌุฉ ูุฅุบูุงู ุงูุฃุชูุชุฉ ุจุงููุงูู

2. **ุชุญูู ุฏููู:**
   - ุชุญุฏูุฏ ุนุฏุฏ ุงูุฃูุงู ุจูู ุงูุชุฐููุฑุงุช
   - ุชุญุฏูุฏ ุนุฏุฏ ุงูุฃูุงู ูุจู ุงูุงุณุชุญูุงู

3. **ุณูููุฉ ุงูุงุณุชุฎุฏุงู:**
   - ูุงุฌูุฉ ูุงุถุญุฉ ูููุธูุฉ
   - ุฅุนุฏุงุฏุงุช ููุทููุฉ ููุงุถุญุฉ

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-01-12  
**ุงูุญุงูุฉ:** โ ููุชูู ูุฌุงูุฒ ููุงุณุชุฎุฏุงู



