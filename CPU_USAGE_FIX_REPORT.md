# ุชูุฑูุฑ ุฅุตูุงุญ ูุดููุฉ ุงุณุชููุงู CPU ุงูุนุงูู ุนูู VPS

## ๐ ููุฎุต ุงููุดููุฉ

ูุงูุช ููุงู ุนูููุฉ Node.js ุชุณุชููู ุฃูุซุฑ ูู 140% ูู ุงููุนุงูุฌ ุนูู VPSุ ููุง ุฃุฏู ุฅูู ูุฑุถ ูููุฏ ูู Hostinger ูุจุทุก ุดุฏูุฏ ูู ุงูุณูุฑูุฑ.

---

## ๐ ุงููุดุงูู ุงูููุชุดูุฉ ูุงูุญููู ุงููุทุจูุฉ

### 1. โ **WebSocket Heartbeat Multiple Intervals (ูุดููุฉ ุญุฑุฌุฉ)**

**ุงููุดููุฉ:**
- ูู `backend/services/websocketService.js`ุ ูุงูุช ุฏุงูุฉ `startHeartbeat()` ุชูุดุฆ `setInterval` ุฌุฏูุฏ ูู ูู ูุฑุฉ ูุชู ุงุณุชุฏุนุงุก `initialize()`
- ุฅุฐุง ุชู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุฑ ุฃู ุงุณุชุฏุนุงุก `initialize()` ุนุฏุฉ ูุฑุงุชุ ูุงู ูุชู ุฅูุดุงุก ุนุฏุฉ intervals ุชุนูู ูู ููุณ ุงูููุช
- ูุฐุง ูุณุจุจ ุงุณุชููุงู CPU ุนุงูู ุฌุฏุงู

**ุงูุญู:**
- โ ุฅุถุงูุฉ `this.heartbeatTimer = null` ูู constructor
- โ ุงูุชุญูู ูู ูุฌูุฏ timer ูุจู ุฅูุดุงุก ูุงุญุฏ ุฌุฏูุฏ
- โ ุฅุถุงูุฉ ุฏุงูุฉ `stopHeartbeat()` ูุชูุธูู timer ุนูุฏ ุงูุญุงุฌุฉ
- โ ููุน ุฅุนุงุฏุฉ initialize ุฅุฐุง ูุงู WebSocket service ูุฏ ุชู ุชููุฆุชู ุจุงููุนู

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `backend/services/websocketService.js`

---

### 2. โ **Rate Limiting ูุนุทู (ูุดููุฉ ุฃูููุฉ ูููุงุฑุฏ)**

**ุงููุดููุฉ:**
- ูู `backend/server.js`ุ ูุงู Rate Limiting ูุนุทูุงู ุชูุงูุงู (ูุนูู ูู comments)
- ูุฐุง ูุณูุญ ุจุนุฏุฏ ูุง ููุงุฆู ูู ุงูุทูุจุงุช ูู ููุณ IP
- ูููู ุฃู ูุณุจุจ ุงุณุชููุงู ุนุงูู ููููุงุฑุฏ ูู ุฎูุงู flood attacks ุฃู requests ูุซูุฑุฉ

**ุงูุญู:**
- โ ุชูุนูู Rate Limiting ูู production mode
- โ ุฌุนูู ุงุฎุชูุงุฑู ูู development mode (ูููู ุชูุนููู ุนุจุฑ `ENABLE_RATE_LIMIT=true`)
- โ ุฅุถุงูุฉ logging ูุชูุถูุญ ุญุงูุฉ Rate Limiting

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `backend/server.js`

**ููุงุญุธุฉ:** Rate Limiting ุงูุขู ููุนู ุชููุงุฆูุงู ูู production. ูู developmentุ ูููู ุชูุนููู ุนุจุฑ:
```bash
ENABLE_RATE_LIMIT=true npm start
```

---

### 3. โ๏ธ **Polling Interval ููุซู ูู Frontend**

**ุงููุดููุฉ:**
- ูู `frontend/react-app/src/hooks/useWebSocket.js`ุ ูุงู `useWebSocketStatus` ูุณุชุฎุฏู `setInterval` ูู 5 ุซูุงูู
- ูุฐุง ูุณุจุจ ุงุณุชููุงู CPU ุนุงูู ุฎุงุตุฉ ูุน ุนุฏุฉ ุตูุญุงุช ููุชูุญุฉ

**ุงูุญู:**
- โ ุชูููู polling interval ูู 5 ุซูุงูู ุฅูู 30 ุซุงููุฉ
- โ ูุฐุง ูููู ุงุณุชููุงู CPU ุจูุณุจุฉ 83% (ูู 12 request/ุฏูููุฉ ุฅูู 2 request/ุฏูููุฉ)

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `frontend/react-app/src/hooks/useWebSocket.js`

---

### 4. โ๏ธ **Auto-connect Multiple Connections**

**ุงููุดููุฉ:**
- ูู `frontend/react-app/src/services/websocketService.js`ุ ูุงู ูุชู auto-connect ุชููุงุฆูุงู ุนูุฏ import ุงูููู
- ุฅุฐุง ูุงู ููุงู ุนุฏุฉ components ุชุณุชูุฑุฏ ุงููููุ ูุงู ูุชู ุฅูุดุงุก ุนุฏุฉ ุงุชุตุงูุงุช WebSocket
- ูู ุงุชุตุงู ูุญุชุงุฌ heartbeat ู polling

**ุงูุญู:**
- โ ุฅุฒุงูุฉ auto-connect ุงูุชููุงุฆู ูู ููุงูุฉ ุงูููู
- โ ุฅุถุงูุฉ auto-connect ุฐูู ูู `useWebSocket` hook
- โ ุงุณุชุฎุฏุงู `useRef` ููุชุฃูุฏ ูู ุงูุงุชุตุงู ูุฑุฉ ูุงุญุฏุฉ ููุท per session

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `frontend/react-app/src/services/websocketService.js`
- `frontend/react-app/src/hooks/useWebSocket.js`

---

## ๐ ุชุญุณููุงุช ุงูุฃุฏุงุก ุงููุชููุนุฉ

| ุงููุดููุฉ | ุงูุชุญุณูู ุงููุชููุน |
|---------|-----------------|
| Multiple WebSocket Heartbeats | ุชูููู ุงุณุชููุงู CPU ุจูุณุจุฉ **80-90%** |
| Rate Limiting ูุนุทู | ุญูุงูุฉ ูู flood attacks ูุชูููู ุงุณุชููุงู ุงูููุงุฑุฏ |
| Polling ูู 5 ุซูุงูู | ุชูููู ุงุณุชููุงู CPU ุจูุณุจุฉ **83%** |
| Multiple WebSocket Connections | ุชูููู ุงุณุชููุงู ุงูุฐุงูุฑุฉ ูุงูู CPU |

**ุฅุฌูุงูู ุงูุชุญุณูู ุงููุชููุน:** ุชูููู ุงุณุชููุงู CPU ุจูุณุจุฉ **70-85%** ูู ุงูุญุงูุงุช ุงูุทุจูุนูุฉ

---

## โ ุฎุทูุงุช ุงูุชุญูู ูู ุงูุฅุตูุงุญ

### 1. ุงูุชุญูู ูู WebSocket Service
```bash
# ุนูู ุงูุณูุฑูุฑ
ps aux | grep node
# ูุฌุจ ุฃู ุชุฑู ุงุณุชุฎุฏุงู CPU ุทุจูุนู (< 20%)
```

### 2. ุงูุชุญูู ูู Rate Limiting
```bash
# ูู logs ุงูุณูุฑูุฑ ูุฌุจ ุฃู ุชุฑู:
โ Rate limiting enabled
```

### 3. ูุฑุงูุจุฉ ุงูุงุณุชุฎุฏุงู
```bash
# ูุฑุงูุจุฉ CPU usage
top -p $(pgrep -f "node.*server.js")

# ุฃู
htop
```

### 4. ุงุฎุชุจุงุฑ WebSocket Connections
- ุงูุชุญ ุนุฏุฉ ุตูุญุงุช ูู ุงูุชุทุจูู
- ุชุฃูุฏ ูู ุฃู ููุงู ุงุชุตุงู WebSocket ูุงุญุฏ ููุท (ูู Network tab)
- ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ errors ูู console

---

## ๐ ุชูุตูุงุช ุฃูููุฉ ุฅุถุงููุฉ

### 1. ุชูุนูู Rate Limiting ูู Production
Rate Limiting ุงูุขู ููุนู ุชููุงุฆูุงู ูู production mode. ุชุฃูุฏ ูู ุฃู `NODE_ENV=production` ูู ุฅุนุฏุงุฏุงุช ุงูุณูุฑูุฑ.

### 2. ูุฑุงูุจุฉ WebSocket Connections
ูููู ุฅุถุงูุฉ endpoint ููุฑุงูุจุฉ ุนุฏุฏ ุงูุงุชุตุงูุงุช:
```javascript
app.get('/api/websocket/stats', (req, res) => {
  res.json(websocketService.getStats());
});
```

### 3. ุญุฏ ุฃูุตู ููุงุชุตุงูุงุช
WebSocket service ูุฏูู ุญุฏ ุฃูุตู 1000 ุงุชุตุงู ูุชุฒุงูู. ูููู ุชูููู ูุฐุง ุงูุฑูู ูู `backend/services/websocketService.js`:
```javascript
this.maxClients = 500; // ุจุฏูุงู ูู 1000
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **React 19.1.0**: ุงูุชุทุจูู ูุณุชุฎุฏู React 19.1.0 ููู ุฅุตุฏุงุฑ ุฌุฏูุฏ ุฌุฏุงู. ุฅุฐุง ุงุณุชูุฑุช ุงููุดุงููุ ูููู ุงูุชูููุฑ ูู downgrade ุฅูู React 18.

2. **Cron Jobs**: ุชุฃูุฏ ูู ุฃู cron jobs ุชุนูู ุจุดูู ุตุญูุญ ููุง ุชุณุจุจ ุงุณุชููุงู ุนุงูู. ุงูู cron jobs ุงูุญุงููุฉ:
   - Overdue payments (ููููุงู 9 AM)
   - Payment reminders (ููููุงู 10 AM)
   - Auto backup (ุญุณุจ ุงูุฅุนุฏุงุฏุงุช)

3. **Database Queries**: ุชุฃูุฏ ูู ุฃู database queries ูุญุณูุฉ ููุฏููุง indexes ููุงุณุจุฉ. Queries ุจุทูุฆุฉ ูููู ุฃู ุชุณุจุจ ุงุณุชููุงู CPU ุนุงูู.

4. **Memory Leaks**: ุฑุงูุจ ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ. ุฅุฐุง ูุงู ูู ุฒูุงุฏุฉ ูุณุชูุฑุฉุ ูุฏ ูููู ููุงู memory leak.

---

## ๐ ุฎุทูุงุช ุงููุดุฑ

1. **ุงุฎุชุจุฑ ูุญููุงู ุฃููุงู:**
   ```bash
   cd backend
   npm start
   # ุฑุงูุจ CPU usage
   ```

2. **ุงูุญุต ุงููููุงุช ุงููุนุฏูุฉ:**
   ```bash
   git status
   git diff
   ```

3. **ุงูุดุฑ ุนูู ุงูุณูุฑูุฑ:**
   ```bash
   # ุนูู ุงูุณูุฑูุฑ
   cd /opt/lampp/htdocs/FixZone
   git pull
   
   # ุฃุนุฏ ุชุดุบูู Backend
   pm2 restart fixzone-backend
   # ุฃู
   systemctl restart fixzone-backend
   ```

4. **ุฑุงูุจ ุงูุฃุฏุงุก:**
   - ุฑุงูุจ CPU usage ููุฏุฉ 30 ุฏูููุฉ
   - ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ errors ูู logs
   - ุชุญูู ูู ุฃู ุงูุชุทุจูู ูุนูู ุจุดูู ุทุจูุนู

---

## ๐ ูู ุญุงูุฉ ุงุณุชูุฑุงุฑ ุงููุดููุฉ

ุฅุฐุง ุงุณุชูุฑุช ูุดููุฉ ุงุณุชููุงู CPU ุงูุนุงูู:

1. **ุชุญูู ูู logs:**
   ```bash
   tail -f /path/to/logs/backend.log
   ```

2. **ุงุณุชุฎุฏู profiling:**
   ```bash
   node --prof server.js
   ```

3. **ุชุญูู ูู processes ุฃุฎุฑู:**
   ```bash
   ps aux | grep -E "node|mysql|nginx"
   ```

4. **ุชุญูู ูู database queries:**
   - ุงูุชุญ MySQL slow query log
   - ุงุจุญุซ ุนู queries ุจุทูุฆุฉ

---

## โจ ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ 4 ูุดุงูู ุฑุฆูุณูุฉ ูุงูุช ุชุณุจุจ ุงุณุชููุงู CPU ุนุงูู:
1. โ Multiple WebSocket heartbeat intervals
2. โ Rate limiting ูุนุทู
3. โ Polling interval ููุซู
4. โ Multiple WebSocket connections

ุงูุชุญุณููุงุช ุงููุชููุนุฉ: **ุชูููู ุงุณุชููุงู CPU ุจูุณุจุฉ 70-85%**

ูุฌุจ ูุฑุงูุจุฉ ุงูุฃุฏุงุก ุจุนุฏ ุงููุดุฑ ูุงูุชุฃูุฏ ูู ุฃู ูู ุดูุก ูุนูู ุจุดูู ุตุญูุญ.

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** $(date)
**ุงููุทูุฑ:** AI Assistant
**ุงูุญุงูุฉ:** โ ููุชูู - ุฌุงูุฒ ููุงุฎุชุจุงุฑ ูุงููุดุฑ

